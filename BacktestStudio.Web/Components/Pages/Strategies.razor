@page "/strategies"
@rendermode InteractiveServer

<PageTitle>策略管理 - BacktestStudio</PageTitle>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="display-5">策略管理</h1>
                <button class="btn btn-primary">
                    <i class="bi bi-plus"></i> 新增策略
                </button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-list"></i> 我的策略</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 策略管理功能開發中，即將推出完整的CRUD功能
                    </div>
                    
                    <!-- 預覽表格 -->
                    <div class="table-responsive">
                        <table class="table table-hover table-financial">
                            <thead class="table-light">
                                <tr>
                                    <th>策略名稱</th>
                                    <th>類型</th>
                                    <th>狀態</th>
                                    <th>績效</th>
                                    <th>建立時間</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <strong>長線策略</strong>
                                        <br><small class="text-muted">基於移動平均線的長線投資策略</small>
                                    </td>
                                    <td><span class="badge badge-gain">多頭</span></td>
                                    <td><span class="badge badge-gain">啟用</span></td>
                                    <td>
                                        <span class="financial-number text-gain">+15.2%</span>
                                        <br><small class="text-muted">勝率: 72%</small>
                                    </td>
                                    <td>2025-01-30</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" title="編輯">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-outline-info" title="檢視">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" title="刪除" @onclick="DeleteLongStrategy">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>短線策略</strong>
                                        <br><small class="text-muted">快速進出的短線交易策略</small>
                                    </td>
                                    <td><span class="badge badge-loss">空頭</span></td>
                                    <td><span class="badge badge-neutral">停用</span></td>
                                    <td>
                                        <span class="financial-number text-loss">-3.8%</span>
                                        <br><small class="text-muted">勝率: 45%</small>
                                    </td>
                                    <td>2025-02-02</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" title="編輯">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-outline-info" title="檢視">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" title="刪除" @onclick="DeleteShortStrategy">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 確認刪除對話框 -->
<ConfirmDialog @ref="confirmDialog"
               Title="刪除策略"
               IconClass="bi bi-exclamation-triangle text-warning"
               Message="@deleteMessage"
               ConfirmButtonText="刪除"
               ConfirmButtonClass="btn-danger"
               OnConfirm="DeleteStrategy"
               OnCancel="CancelDelete" />

@code {
    private ConfirmDialog? confirmDialog;
    private int strategyToDelete = 0;
    private string deleteMessage = "";
    
    private void ShowDeleteConfirm(int strategyId, string strategyName)
    {
        strategyToDelete = strategyId;
        deleteMessage = $"確定要刪除策略 \"{strategyName}\" 嗎？此操作無法復原。";
        
        if (confirmDialog == null)
        {
            return;
        }
        
        confirmDialog.Show();
        InvokeAsync(StateHasChanged);
    }
    
    private void DeleteLongStrategy()
    {
        ShowDeleteConfirm(1, "長線策略");
    }
    
    private void DeleteShortStrategy()
    {
        ShowDeleteConfirm(2, "短線策略");
    }
    
    private async Task DeleteStrategy()
    {
        // 這裡實作刪除策略的邏輯
        // 例如：await ApiService.DeleteStrategyAsync(strategyToDelete);
        
        // 模擬刪除操作
        await Task.Delay(500);
        
        // 顯示成功訊息或重新載入策略列表
        // 實際開發時會重新載入資料
        strategyToDelete = 0;
    }
    
    private void CancelDelete()
    {
        strategyToDelete = 0;
        deleteMessage = "";
    }
}